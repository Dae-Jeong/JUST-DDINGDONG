/**
 * Git Hooks ìë™ ì„¤ì¹˜ ë° ê´€ë¦¬
 *
 * íŒ€ ì „ì²´ì˜ ì½”ë“œ í’ˆì§ˆ ì¼ê´€ì„±ì„ ìœ„í•´ Git pre-commit hookì„ ìë™ìœ¼ë¡œ ì„¤ì¹˜í•©ë‹ˆë‹¤.
 * ì»¤ë°‹ ì „ì— ì½”ë“œ í¬ë§·íŒ… ê²€ì‚¬ë¥¼ ìˆ˜í–‰í•˜ì—¬ ì¼ê´€ëœ ì½”ë“œ ìŠ¤íƒ€ì¼ì„ ìœ ì§€í•©ë‹ˆë‹¤.
 */

// Git hooks installation task
tasks.register('installGitHooks') {
    description = 'Install Git hooks for code formatting'
    group = 'git'

    doLast {
        def gitHooksDir = file('.git/hooks')
        def preCommitHook = file('.git/hooks/pre-commit')

        // Create hooks directory if it doesn't exist
        if (!gitHooksDir.exists()) {
            gitHooksDir.mkdirs()
        }

        // Create pre-commit hook content
        def hookContent = '''#!/bin/sh
# Auto-generated pre-commit hook for code formatting

echo "Running code formatting check..."

# Run spotless check
./gradlew spotlessCheck --quiet

if [ $? -ne 0 ]; then
    echo "âŒ Code formatting check failed!"
    echo "ğŸ’¡ Run './gradlew spotlessApply' to fix formatting issues."
    exit 1
fi

echo "âœ… Code formatting check passed!"
'''

        // Write hook file
        preCommitHook.text = hookContent

        // Make it executable (Unix/Mac only)
        if (!System.getProperty('os.name').toLowerCase().contains('windows')) {
            try {
                def process = ['chmod', '+x', preCommitHook.absolutePath].execute()
                process.waitFor()
            } catch (Exception e) {
                println "âš ï¸  Could not make hook executable: ${e.message}"
                println "ğŸ’¡ Please run: chmod +x .git/hooks/pre-commit"
            }
        }

        println 'âœ… Git pre-commit hook installed successfully!'
        println 'ğŸ’¡ The hook will check code formatting before each commit.'
    }
}

// Automatically install git hooks after project setup
tasks.named('build') {
    dependsOn 'installGitHooks'
}